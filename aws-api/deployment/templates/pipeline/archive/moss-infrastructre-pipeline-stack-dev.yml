Description: Creates the pipeline for sixter deployment
AWSTemplateFormatVersion: "2010-09-09"
Parameters:
  NamePrefix:
    Type: String
    Default: Aws
    Description: Prefix added to the name of resources created in this stack. It correspond to the service tag
  EnableDeploymentToDev:
    Type: String
    Default: true
    AllowedValues:
      - true
      - false
    Description: Enables the deployment of the app stack to the development account. When disabled it removes the existing stack
  EnableDeploymentToAcc:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false
    Description: Enables the deployment of the app stack to the acceptance account. When disabled it removes the existing stack
  EnableDeploymentToPrd:
    Type: String
    Default: false
    AllowedValues:
      - true
      - false
    Description: Enables the deployment of the app stack to the production account. When disabled it removes the existing stack
  DevelopmentAccount:
    Type: String
    Default: "551493771163"
    Description: The id of the development account
  AcceptanceAccount:
    Type: String
    Default: "489962969526"
    Description: The id of the acceptance account
  ProductionAccount:
    Type: String
    Default: "278720074780"
    Description: The id of the production account
  CICDDeploymentAccount:
    Type: String
    Default: xxxxx
    Description: The id of the CICD Deployment account
  BudgetUnitCode:
    Type: String
    Default: madrid-Aws
    Description: The value for the budget-unit-code tag
  BusinessImpactLevel:
    Type: String
    Default: "2"
    AllowedValues:
      - "1"
      - "2"
      - "3"
      - "4"
    Description: The value for the business-impact-level tag
  BusinessOwner:
    Type: String
    Default: benoit.aperce@wipo.int
    Description: The value for the business-owner tag
  BusinessUnitName:
    Type: String
    Default: madrid
    Description: The value for the business-unit-name tag
  DataClassification:
    Type: String
    Default: confidential
    AllowedValues:
      - public
      - for_official_use_only
      - confidential
      - highly_confidential
    Description: The value for the data-classification tag
  TechnicalOwner:
    Type: String
    Default: don.onwunumah@wipo.int
    Description: The value for the technical-owner tag
  DRRegion:
    Type: String
    Default: eu-west-3
    Description: The disaster recovery region
  CicdRole:
    Type: String
    Default: cicd-default
    Description: Role to assume to push the artifacts
  CicdAccount:
    Type: String
    Default: "173148697964"
    Description: The id of the cicd account
  BootstrapVersion:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /cdk-bootstrap/hnb659fds/version
    Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]
Conditions:
  EnableDeploymentToDev:
    Fn::Equals:
      - Ref: EnableDeploymentToDev
      - true
  EnableDeploymentToAcc:
    Fn::Equals:
      - Ref: EnableDeploymentToAcc
      - true
  IsCicdAccount:
    Fn::Equals:
      - Ref: AWS::AccountId
      - "173148697964"
Resources:
  KMSKey:
    Type: AWS::KMS::Key
    Properties:
      Description: Used by Assumed Roles in dev/acc/prd accounts to Encrypt/Decrypt artifacts
      EnableKeyRotation: true
      KeyPolicy:
        Version: "2012-10-17"
        Id:
          Ref: AWS::StackName
        Statement:
          - Sid: Allows admin of the key
            Effect: Allow
            Principal:
              AWS:
                Fn::Sub: arn:aws:iam::${AWS::AccountId}:root
            Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
            Resource: "*"
          - Sid: Allow use of the key to other accounts
            Effect: Allow
            Principal:
              AWS:
                - Fn::Sub: arn:aws:iam::${AWS::AccountId}:root
                - Fn::Sub: arn:aws:iam::${CicdAccount}:root
            Action:
              - kms:Encrypt
              - kms:Decrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
              - kms:DescribeKey
            Resource: "*"
          - Sid: Allow use of the key to other accounts
            Effect: Allow
            Principal:
              AWS:
                - Fn::Sub: arn:aws:iam::${DevelopmentAccount}:root
                - Fn::Sub: arn:aws:iam::${AcceptanceAccount}:root
                - Fn::Sub: arn:aws:iam::${ProductionAccount}:root
            Action:
              - kms:Decrypt
              - kms:DescribeKey
            Resource: "*"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
  KMSAlias:
    Type: AWS::KMS::Alias
    Properties:
      AliasName:
        Fn::Sub: alias/${NamePrefix}-crossaccount-cmk
      TargetKeyId:
        Ref: KMSKey
  
  ArtifactsBucket:
    Type: AWS::S3::Bucket
    DeletionPolicy: Retain
    UpdateReplacePolicy: Retain
    Properties:
      BucketName:
        Fn::Sub: ${NamePrefix}-artifacts-${AWS::Region}-${AWS::AccountId}
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: aws:kms
              KMSMasterKeyID: !Ref KMSKey
      LifecycleConfiguration:
        Rules:
          - Id: NonCurrentAndIncompleteVersions
            Status: Enabled
            NoncurrentVersionExpirationInDays: 30
            AbortIncompleteMultipartUpload:
              DaysAfterInitiation: 3
          - Id: ExpirePipelineSources
            Status: Enabled
            Prefix: !Sub ${NamePrefix}/
            ExpirationInDays: 30
          - Id: ExpireDevBuilds
            Status: Enabled
            Prefix: builds/
            ExpirationInDays: 30
            TagFilters:
              - Key: environment
                Value: dev
          - Id: ExpireAccBuilds
            Status: Enabled
            Prefix: builds/
            ExpirationInDays: 180
            TagFilters:
              - Key: environment
                Value: acc
      OwnershipControls:
        Rules:
          - ObjectOwnership: BucketOwnerPreferred
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      VersioningConfiguration:
        Status: Enabled
        
  
  ArtifactsBucketPolicy:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: ArtifactsBucket
      PolicyDocument:
        Id:
          Fn::Sub: ${NamePrefix}-artifacts-bucket-policy
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS:
                - Fn::Sub: arn:aws:iam::${CicdAccount}:root
                - Fn::Sub: arn:aws:iam::${DevelopmentAccount}:root
                - Fn::Sub: arn:aws:iam::${AcceptanceAccount}:root
                - Fn::Sub: arn:aws:iam::${ProductionAccount}:root
            Action:
              - s3:ListBucket
              - s3:GetObject
              - s3:PutObject*
              - s3:ObjectOwnerOverrideToBucketOwner
            Resource:
              - Fn::Sub: arn:aws:s3:::${ArtifactsBucket}
              - Fn::Sub: arn:aws:s3:::${ArtifactsBucket}/*
          - Effect: Allow
            Principal:
              AWS:
                - Fn::Sub: arn:aws:iam::${CicdAccount}:root
            Action:
              - s3:List*
              - s3:GetBucketVersioning
              - s3:PutBucketVersioning
            Resource:
              - Fn::Sub: arn:aws:s3:::${ArtifactsBucket}
              - Fn::Sub: arn:aws:s3:::${ArtifactsBucket}/*
  
  PushImagesPolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - ecr:GetAuthorizationToken
            Resource: "*"
          - Effect: Allow
            Action:
              - ecr:BatchCheckLayerAvailability
              - ecr:GetDownloadUrlForLayer
              - ecr:GetRepositoryPolicy
              - ecr:DescribeRepositories
              - ecr:ListImages
              - ecr:DescribeImages
              - ecr:BatchGetImage
              - ecr:InitiateLayerUpload
              - ecr:UploadLayerPart
              - ecr:CompleteLayerUpload
              - ecr:PutImage
            Resource:
              - Fn::Sub: arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/${NamePrefix}/*
              - Fn::Sub: arn:aws:ecr:${AWS::Region}:${DevelopmentAccount}:repository/${NamePrefix}/*
      PolicyName:
        Fn::Sub: ${NamePrefix}-push-images-policy
      Roles:
        - Ref: CicdRole
    Condition: IsCicdAccount
  
  PutPackagePolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - s3:PutObject*
            Resource:
              - Fn::Sub: arn:aws:s3:::${ArtifactsBucket}/package.zip
              - Fn::Sub: arn:aws:s3:::${NamePrefix}-artifacts-${AWS::Region}-${DevelopmentAccount}/package.zip
      PolicyName:
        Fn::Sub: ${NamePrefix}-put-package-policy
      Roles:
        - Ref: CicdRole
    Condition: IsCicdAccount
    
  
  BuildRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
            Action:
              - sts:AssumeRole
      Path: /
      RoleName:
        Fn::Sub: ${NamePrefix}-build-role
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
  
  BuildProjectPolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyName: !Sub ${NamePrefix}-build-policy
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action:
              - s3:PutObject*
              - s3:DeleteObject
              - s3:GetObject*
              - s3:ListBucket
            Resource:
              - !Sub arn:aws:s3:::${ArtifactsBucket}
              - !Sub arn:aws:s3:::${ArtifactsBucket}/*
          - Effect: Allow
            Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Resource: !Sub arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:*
      Roles:
        - !Ref BuildRole
        
  
  CmkPolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - kms:Encrypt
              - kms:Decrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
              - kms:DescribeKey
            Resource: !GetAtt KMSKey.Arn
      PolicyName:
        Fn::Sub: ${NamePrefix}-cmk-policy
      Roles:
        - Ref: BuildRole
        - Fn::If:
            - IsCicdAccount
            - Ref: CicdRole
            - Ref: AWS::NoValue
              
  
  PipelineRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - codepipeline.amazonaws.com
            Action:
              - sts:AssumeRole
      Path: /
      RoleName:
        Fn::Sub: ${NamePrefix}-pipeline-role
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
  
  ArtifactsBucketReadWritePolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - s3:PutObject*
              - s3:GetObject*
              - s3:ListBucket
            Resource:
              - Fn::Sub: arn:aws:s3:::${ArtifactsBucket}
              - Fn::Sub: arn:aws:s3:::${ArtifactsBucket}/*
      PolicyName:
        Fn::Sub: ${NamePrefix}-artifacts-bucket-readwrite-policy
      Roles:
        - Ref: BuildRole
        - Ref: PipelineRole
        - Fn::If:
            - IsCicdAccount
            - Ref: CicdRole
            - Ref: AWS::NoValue
  
  AssumeRolePolicy:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - sts:AssumeRole
            Resource:
              - Fn::Sub: arn:aws:iam::${DevelopmentAccount}:role/${NamePrefix}-cicd-role
              - Fn::Sub: arn:aws:iam::${AcceptanceAccount}:role/${NamePrefix}-cicd-role
              - Fn::Sub: arn:aws:iam::${ProductionAccount}:role/${NamePrefix}-cicd-role
      PolicyName:
        Fn::Sub: ${NamePrefix}-assume-role-policy
      Roles:
        - Ref: PipelineRole
          
  PipeLineRoleParam:
    Type: AWS::SSM::Parameter
    Properties:
      Description: The PipelineRole ARN
      Name:
        Fn::Sub: /${NamePrefix}/pipeLineRoleARN
      Tags:
        budget-unit-code: madrid-Aws
      Type: String
      Value:
        Fn::GetAtt: PipelineRole.Arn
  DevAccountRoleParam:
    Type: AWS::SSM::Parameter
    Properties:
      Description: The CICD role for DEV ARN
      Name:
        Fn::Sub: /${NamePrefix}/DevAccountRoleARN
      Tags:
        budget-unit-code: madrid-Aws
      Type: String
      Value:
        Fn::Sub: arn:aws:iam::${DevelopmentAccount}:role/${NamePrefix}-cicd-role
  AccAccountRoleParam:
    Type: AWS::SSM::Parameter
    Properties:
      Description: The CICD role for ACC ARN
      Name:
        Fn::Sub: /${NamePrefix}/AccAccountRoleARN
      Tags:
        budget-unit-code: madrid-Aws
      Type: String
      Value:
        Fn::Sub: arn:aws:iam::${AcceptanceAccount}:role/${NamePrefix}-cicd-role
  PrdAccountRoleParam:
    Type: AWS::SSM::Parameter
    Properties:
      Description: The CICD role for PRD ARN
      Name:
        Fn::Sub: /${NamePrefix}/PrdAccountRoleARN
      Tags:
        budget-unit-code: madrid-Aws
      Type: String
      Value:
        Fn::Sub: arn:aws:iam::${ProductionAccount}:role/${NamePrefix}-cicd-role
  pipelinerolePolicyD237F425:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - s3:Abort*
              - s3:DeleteObject*
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
              - s3:PutObject
              - s3:PutObjectLegalHold
              - s3:PutObjectRetention
              - s3:PutObjectTagging
              - s3:PutObjectVersionTagging
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
          - Action: sts:AssumeRole
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIV1StacksCodePipelineActionRole2EA3CB39
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIv2StacksCodePipelineActionRoleCB0AF5FD
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployEventStacksCodePipelineActionRole3711E85C
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAuthStackDeployStageDeployAuthStacksCodePipelineActionRoleF04404E7
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineEECRBucketseployStageDeployBucketsECRStacksCodePipelineActionRole3200B7E7
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployAPiDocStacksCodePipelineActionRole90ECF200
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployFrontEndStacksCodePipelineActionRole3D543CA6
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineInfraSourceCopyStageInfraS3CopyCodePipelineActionRole2997BAF4
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineInfraSourceStageInfraS3SourceCloneCodePipelineActionRole00531D9E
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackCodePipelineActionRoleAD666126
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceMediaStackCodePipelineActionRole7E7C6A47
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployECSClusterCodePipelineActionRoleA7D053DE
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployRDSStacksCodePipelineActionRole4222540C
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineRegsitryDeployStageDeployRegistryStacksCodePipelineActionRoleFFE0A081
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineVPCDeployStageDeployVPCInfraStacksCodePipelineActionRole02A6206F
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndCertCodePipelineActionRole077A0FFC
                  - Arn
              - Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndWAFCodePipelineActionRole784FBF03
                  - Arn
        Version: "2012-10-17"
      PolicyName: pipelinerolePolicyD237F425
      Roles:
        - Fn::Select:
            - 1
            - Fn::Split:
                - /
                - Fn::Select:
                    - 5
                    - Fn::Split:
                        - ":"
                        - Fn::GetAtt:
                            - PipelineRole
                            - Arn
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/pipelinerole/Policy/Resource
  
  AwsInfrastructurePipelineCICDPipeline30531348:
    Type: AWS::CodePipeline::Pipeline
    DependsOn: AssumeRolePolicy
    Properties:
      ArtifactStore:
        Location: !Ref ArtifactsBucket
        EncryptionKey:
          Id: !GetAtt KMSKey.Arn
          Type: KMS
        Type: S3
      Name: Aws-AwsInfrastructurePipeline
      PipelineType: V2
      RoleArn:
        Fn::GetAtt:
          - PipelineRole
          - Arn
      Stages:
        - Actions:
            - ActionTypeId:
                Category: Source
                Owner: AWS
                Provider: S3
                Version: "1"
              Configuration:
                S3Bucket: !Ref ArtifactsBucket
                S3ObjectKey: package.zip
              Name: InfraS3SourceClone
              OutputArtifacts:
                - Name: SourceOutput
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineInfraSourceStageInfraS3SourceCloneCodePipelineActionRole00531D9E
                  - Arn
              RunOrder: 1
          Name: InfraSourceStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProject2CCB8EC2
              InputArtifacts:
                - Name: SourceOutput
              Name: InfraS3Copy
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineInfraSourceCopyStageInfraS3CopyCodePipelineActionRole2997BAF4
                  - Arn
              RunOrder: 1
          Name: InfraSourceCopyStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProject534CF232
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployBucketsECRStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineEECRBucketseployStageDeployBucketsECRStacksCodePipelineActionRole3200B7E7
                  - Arn
              RunOrder: 1
          Name: EECRBucketseployStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProject2F71B601
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployVPCInfraStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineVPCDeployStageDeployVPCInfraStacksCodePipelineActionRole02A6206F
                  - Arn
              RunOrder: 1
          Name: VPCDeployStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProject6A6EAB55
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployRDSStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployRDSStacksCodePipelineActionRole4222540C
                  - Arn
              RunOrder: 1
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProject0DAA1980
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployECSCluster
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployECSClusterCodePipelineActionRoleA7D053DE
                  - Arn
              RunOrder: 2
          Name: RDSDeployStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectD788BC65
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployRegistryStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineRegsitryDeployStageDeployRegistryStacksCodePipelineActionRoleFFE0A081
                  - Arn
              RunOrder: 1
          Name: RegsitryDeployStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProject3A551A8C
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployFrontEndWAF
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndWAFCodePipelineActionRole784FBF03
                  - Arn
              RunOrder: 1
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectE4A1713C
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployFrontEndCert
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndCertCodePipelineActionRole077A0FFC
                  - Arn
              RunOrder: 2
          Name: WAFCertsStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectF2FAE9E9
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployMicroServiceDBAccessStack
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackCodePipelineActionRoleAD666126
                  - Arn
              RunOrder: 1
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProject0EF57BEB
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployMicroServiceMediaStack
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceMediaStackCodePipelineActionRole7E7C6A47
                  - Arn
              RunOrder: 1
          Name: MicroServiceDeployStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProject4F271912
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployAuthStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAuthStackDeployStageDeployAuthStacksCodePipelineActionRoleF04404E7
                  - Arn
              RunOrder: 1
          Name: AuthStackDeployStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProject5AD64EDB
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployAPIV1Stacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIV1StacksCodePipelineActionRole2EA3CB39
                  - Arn
              RunOrder: 1
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectE72D7384
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployAPIv2Stacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIv2StacksCodePipelineActionRoleCB0AF5FD
                  - Arn
              RunOrder: 2
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProject526CAEB8
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployEventStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployEventStacksCodePipelineActionRole3711E85C
                  - Arn
              RunOrder: 3
          Name: APIStackDeployStage
        - Actions:
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProject06A26654
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployFrontEndStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployFrontEndStacksCodePipelineActionRole3D543CA6
                  - Arn
              RunOrder: 1
            - ActionTypeId:
                Category: Build
                Owner: AWS
                Provider: CodeBuild
                Version: "1"
              Configuration:
                ProjectName:
                  Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectA6CA319E
              InputArtifacts:
                - Name: SourceOutput
              Name: DeployAPiDocStacks
              RoleArn:
                Fn::GetAtt:
                  - AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployAPiDocStacksCodePipelineActionRole90ECF200
                  - Arn
              RunOrder: 2
          Name: FrontEndDeployStage
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/Resource
  
  AwsInfrastructurePipelineCICDPipelineInfraSourceStageInfraS3SourceCloneCodePipelineActionRole00531D9E:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/InfraSourceStage/InfraS3SourceClone/CodePipelineActionRole/Resource
  
  AwsInfrastructurePipelineCICDPipelineInfraSourceStageInfraS3SourceCloneCodePipelineActionRoleDefaultPolicyC8BABF95:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/package.zip
          - Action:
              - s3:Abort*
              - s3:DeleteObject*
              - s3:PutObject
              - s3:PutObjectLegalHold
              - s3:PutObjectRetention
              - s3:PutObjectTagging
              - s3:PutObjectVersionTagging
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineInfraSourceStageInfraS3SourceCloneCodePipelineActionRoleDefaultPolicyC8BABF95
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineInfraSourceStageInfraS3SourceCloneCodePipelineActionRole00531D9E
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/InfraSourceStage/InfraS3SourceClone/CodePipelineActionRole/DefaultPolicy/Resource
  
  AwsInfrastructurePipelineCICDPipelineInfraSourceCopyStageInfraS3CopyCodePipelineActionRole2997BAF4:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/InfraSourceCopyStage/InfraS3Copy/CodePipelineActionRole/Resource
  
  AwsInfrastructurePipelineCICDPipelineInfraSourceCopyStageInfraS3CopyCodePipelineActionRoleDefaultPolicyEC2B70DC:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProject2CCB8EC2
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineInfraSourceCopyStageInfraS3CopyCodePipelineActionRoleDefaultPolicyEC2B70DC
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineInfraSourceCopyStageInfraS3CopyCodePipelineActionRole2997BAF4
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/InfraSourceCopyStage/InfraS3Copy/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineEECRBucketseployStageDeployBucketsECRStacksCodePipelineActionRole3200B7E7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/EECRBucketseployStage/DeployBucketsECRStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineEECRBucketseployStageDeployBucketsECRStacksCodePipelineActionRoleDefaultPolicyC31C322E:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProject534CF232
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineEECRBucketseployStageDeployBucketsECRStacksCodePipelineActionRoleDefaultPolicyC31C322E
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineEECRBucketseployStageDeployBucketsECRStacksCodePipelineActionRole3200B7E7
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/EECRBucketseployStage/DeployBucketsECRStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineVPCDeployStageDeployVPCInfraStacksCodePipelineActionRole02A6206F:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/VPCDeployStage/DeployVPCInfraStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineVPCDeployStageDeployVPCInfraStacksCodePipelineActionRoleDefaultPolicy5A7614A1:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProject2F71B601
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineVPCDeployStageDeployVPCInfraStacksCodePipelineActionRoleDefaultPolicy5A7614A1
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineVPCDeployStageDeployVPCInfraStacksCodePipelineActionRole02A6206F
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/VPCDeployStage/DeployVPCInfraStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployRDSStacksCodePipelineActionRole4222540C:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/RDSDeployStage/DeployRDSStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployRDSStacksCodePipelineActionRoleDefaultPolicyD2A897CF:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProject6A6EAB55
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployRDSStacksCodePipelineActionRoleDefaultPolicyD2A897CF
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployRDSStacksCodePipelineActionRole4222540C
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/RDSDeployStage/DeployRDSStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployECSClusterCodePipelineActionRoleA7D053DE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/RDSDeployStage/DeployECSCluster/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployECSClusterCodePipelineActionRoleDefaultPolicyD7F724AC:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProject0DAA1980
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployECSClusterCodePipelineActionRoleDefaultPolicyD7F724AC
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineRDSDeployStageDeployECSClusterCodePipelineActionRoleA7D053DE
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/RDSDeployStage/DeployECSCluster/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineRegsitryDeployStageDeployRegistryStacksCodePipelineActionRoleFFE0A081:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/RegsitryDeployStage/DeployRegistryStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineRegsitryDeployStageDeployRegistryStacksCodePipelineActionRoleDefaultPolicy9A42C383:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectD788BC65
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineRegsitryDeployStageDeployRegistryStacksCodePipelineActionRoleDefaultPolicy9A42C383
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineRegsitryDeployStageDeployRegistryStacksCodePipelineActionRoleFFE0A081
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/RegsitryDeployStage/DeployRegistryStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndWAFCodePipelineActionRole784FBF03:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/WAFCertsStage/DeployFrontEndWAF/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndWAFCodePipelineActionRoleDefaultPolicy45B69574:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProject3A551A8C
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndWAFCodePipelineActionRoleDefaultPolicy45B69574
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndWAFCodePipelineActionRole784FBF03
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/WAFCertsStage/DeployFrontEndWAF/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndCertCodePipelineActionRole077A0FFC:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/WAFCertsStage/DeployFrontEndCert/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndCertCodePipelineActionRoleDefaultPolicyC6743DE9:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectE4A1713C
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndCertCodePipelineActionRoleDefaultPolicyC6743DE9
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineWAFCertsStageDeployFrontEndCertCodePipelineActionRole077A0FFC
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/WAFCertsStage/DeployFrontEndCert/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackCodePipelineActionRoleAD666126:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/MicroServiceDeployStage/DeployMicroServiceDBAccessStack/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackCodePipelineActionRoleDefaultPolicy34A17F17:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectF2FAE9E9
                - Arn
        Version: "2012-10-17"
      PolicyName: rastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackCodePipelineActionRoleDefaultPolicy34A17F17
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackCodePipelineActionRoleAD666126
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/MicroServiceDeployStage/DeployMicroServiceDBAccessStack/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceMediaStackCodePipelineActionRole7E7C6A47:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/MicroServiceDeployStage/DeployMicroServiceMediaStack/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceMediaStackCodePipelineActionRoleDefaultPolicy83636AE5:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProject0EF57BEB
                - Arn
        Version: "2012-10-17"
      PolicyName: InfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceMediaStackCodePipelineActionRoleDefaultPolicy83636AE5
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineMicroServiceDeployStageDeployMicroServiceMediaStackCodePipelineActionRole7E7C6A47
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/MicroServiceDeployStage/DeployMicroServiceMediaStack/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineAuthStackDeployStageDeployAuthStacksCodePipelineActionRoleF04404E7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/AuthStackDeployStage/DeployAuthStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineAuthStackDeployStageDeployAuthStacksCodePipelineActionRoleDefaultPolicyF5D58194:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProject4F271912
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineAuthStackDeployStageDeployAuthStacksCodePipelineActionRoleDefaultPolicyF5D58194
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineAuthStackDeployStageDeployAuthStacksCodePipelineActionRoleF04404E7
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/AuthStackDeployStage/DeployAuthStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIV1StacksCodePipelineActionRole2EA3CB39:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/APIStackDeployStage/DeployAPIV1Stacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIV1StacksCodePipelineActionRoleDefaultPolicy71AEFC17:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProject5AD64EDB
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIV1StacksCodePipelineActionRoleDefaultPolicy71AEFC17
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIV1StacksCodePipelineActionRole2EA3CB39
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/APIStackDeployStage/DeployAPIV1Stacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIv2StacksCodePipelineActionRoleCB0AF5FD:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/APIStackDeployStage/DeployAPIv2Stacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIv2StacksCodePipelineActionRoleDefaultPolicy362EAE1D:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectE72D7384
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIv2StacksCodePipelineActionRoleDefaultPolicy362EAE1D
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployAPIv2StacksCodePipelineActionRoleCB0AF5FD
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/APIStackDeployStage/DeployAPIv2Stacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployEventStacksCodePipelineActionRole3711E85C:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/APIStackDeployStage/DeployEventStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployEventStacksCodePipelineActionRoleDefaultPolicyD9350AB0:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProject526CAEB8
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployEventStacksCodePipelineActionRoleDefaultPolicyD9350AB0
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineAPIStackDeployStageDeployEventStacksCodePipelineActionRole3711E85C
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/APIStackDeployStage/DeployEventStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployFrontEndStacksCodePipelineActionRole3D543CA6:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/FrontEndDeployStage/DeployFrontEndStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployFrontEndStacksCodePipelineActionRoleDefaultPolicyDE6CE0A6:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProject06A26654
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployFrontEndStacksCodePipelineActionRoleDefaultPolicyDE6CE0A6
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployFrontEndStacksCodePipelineActionRole3D543CA6
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/FrontEndDeployStage/DeployFrontEndStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployAPiDocStacksCodePipelineActionRole90ECF200:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              AWS: arn:aws:iam::551493771163:root
        Version: "2012-10-17"
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/FrontEndDeployStage/DeployAPiDocStacks/CodePipelineActionRole/Resource
  AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployAPiDocStacksCodePipelineActionRoleDefaultPolicy3E00BE10:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - codebuild:BatchGetBuilds
              - codebuild:StartBuild
              - codebuild:StopBuild
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectA6CA319E
                - Arn
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployAPiDocStacksCodePipelineActionRoleDefaultPolicy3E00BE10
      Roles:
        - Ref: AwsInfrastructurePipelineCICDPipelineFrontEndDeployStageDeployAPiDocStacksCodePipelineActionRole90ECF200
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/CICDPipeline/FrontEndDeployStage/DeployAPiDocStacks/CodePipelineActionRole/DefaultPolicy/Resource
  AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProjectRoleA214A9A6:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/InfraSourceCopyStage-InfraS3Copy-Project/Role/Resource
  
  AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProjectRoleDefaultPolicy1798488A:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProject2CCB8EC2
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProject2CCB8EC2
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProject2CCB8EC2
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProjectRoleDefaultPolicy1798488A
      Roles:
        - Ref: AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProjectRoleA214A9A6
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/InfraSourceCopyStage-InfraS3Copy-Project/Role/DefaultPolicy/Resource
  
  AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProject2CCB8EC2:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineInfraSourceCopyStageInfraS3CopyProjectRoleA214A9A6
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "python": "3.11"
                },
                "commands": [
                  "pip install --upgrade pip",
                  "pip install awscli"
                ]
              },
              "pre_build": {
                "commands": [
                  "echo Retrieving information from artifacts...",
                  "DATE=$(date '+%y-%m-%d')",
                  "ls -al $CODEBUILD_SRC_DIR",
                  "COMMIT=\"0\"",
                  "PREFIX=$PROJECT_PREFIX",
                  "ARTIFACTS_ACCOUNT=551493771163",
                  "if [ -f \"cicd-package.json\" ]; then COMMIT=$(jq -r '.build.number' cicd-package.json | sed 's/null/0/g' | sed 's/BUILD_NUMBER/0/g'); fi",
                  "echo commit $COMMIT",
                  "SHORT_SOURCE_VERSION=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | head -c 8)",
                  "echo $SHORT_SOURCE_VERSION",
                  "BUILD_ID=$DATE.$COMMIT.$SHORT_SOURCE_VERSION"
                ]
              },
              "build": {
                "commands": [
                  "echo Building the parameters file...",
                  "touch templates/iac/master-parameters.json",
                  "ARTIFACTS_BUCKET=${PREFIX}-artifacts-${AWS_REGION}-${ARTIFACTS_ACCOUNT}",
                  "printf '{\"Parameters\":{'  templates/iac/master-parameters.json",
                  "printf '\"BuildId\":\"%s\",' $BUILD_ID  templates/iac/master-parameters.json",
                  "printf '\"BusinessUnitCodeName\":\"%s\",' \"${BUDGET_UNIT_CODE}\"  templates/iac/master-parameters.json",
                  "printf '\"AppId\":\"%s\",' \"${APP_ID}\"  templates/iac/master-parameters.json",
                  "printf '\"BusinessImpactLevelName\":\"%s\",' \"${BUSINESS_IMPACT_LEVEL}\"  templates/iac/master-parameters.json",
                  "printf '\"BusinessOwnerName\":\"%s\",' \"${BUSINESS_OWNER}\"  templates/iac/master-parameters.json",
                  "printf '\"BusinessUnitNameName\":\"%s\",' \"${BUSINESS_UNIT_NAME}\"  templates/iac/master-parameters.json",
                  "printf '\"DataClassificationName\":\"%s\",' \"${DATA_CLASSIFICATION}\"  templates/iac/master-parameters.json",
                  "printf '\"TechnicalOwnerName\":\"%s\"' \"${TECHNICAL_OWNER}\"  templates/iac/master-parameters.json",
                  "printf '},'  templates/iac/master-parameters.json",
                  "printf '\"Tags\":{'  templates/iac/master-parameters.json",
                  "printf '\"budget-unit-code\":\"%s\",' \"${BUDGET_UNIT_CODE}\"  templates/iac/master-parameters.json",
                  "printf '\"business-impact-level\":\"%s\",' \"${BUSINESS_IMPACT_LEVEL}\"  templates/iac/master-parameters.json",
                  "printf '\"business-owner\":\"%s\",' \"${BUSINESS_OWNER}\"  templates/iac/master-parameters.json",
                  "printf '\"business-unit-name\":\"%s\",' \"${BUSINESS_UNIT_NAME}\"  templates/iac/master-parameters.json",
                  "printf '\"data-classification\":\"%s\",' \"${DATA_CLASSIFICATION}\"  templates/iac/master-parameters.json",
                  "printf '\"service\":\"%s\",' \"${PREFIX}\"  templates/iac/master-parameters.json",
                  "printf '\"technical-owner\":\"%s\"}}' \"${TECHNICAL_OWNER}\"  templates/iac/master-parameters.json",
                  "cat templates/iac/master-parameters.json"
                ]
              },
              "post_build": {
                "commands": [
                  "echo Copying application, database and cloudFormation templates to S3",
                  "zip templates/iac/master.zip templates/iac/master.yml templates/iac/master-parameters.json",
                  "aws s3 cp --recursive artifacts s3://$ARTIFACTS_BUCKET/builds/$BUILD_ID/artifacts/",
                  "aws s3 cp --recursive templates s3://$ARTIFACTS_BUCKET/builds/$BUILD_ID/templates/"
                ]
              }
            },
            "artifacts": {
              "secondary-artifacts": {
                "BuildArtifact": {
                  "files": [
                    "templates/iac/master.yml",
                    "templates/iac/master-parameters.json",
                    "templates/iac/master*.yml"
                  ]
                }
              }
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/InfraSourceCopyStage-InfraS3Copy-Project/Resource
  
  AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProjectRole331741D5:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/EECRBucketseployStage-DeployBucketsECRStacks-Project/Role/Resource
  
  AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProjectRoleDefaultPolicyBE43DE48:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProject534CF232
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProject534CF232
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProject534CF232
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProjectRoleDefaultPolicyBE43DE48
      Roles:
        - Ref: AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProjectRole331741D5
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/EECRBucketseployStage-DeployBucketsECRStacks-Project/Role/DefaultPolicy/Resource
  
  AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProject534CF232:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineEECRBucketseployStageDeployBucketsECRStacksProjectRole331741D5
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsInfraCfnBucketsECRStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/EECRBucketseployStage-DeployBucketsECRStacks-Project/Resource
  
  AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProjectRoleE6260C58:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/VPCDeployStage-DeployVPCInfraStacks-Project/Role/Resource
  
  AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProjectRoleDefaultPolicy4FE1952B:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProject2F71B601
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProject2F71B601
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProject2F71B601
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProjectRoleDefaultPolicy4FE1952B
      Roles:
        - Ref: AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProjectRoleE6260C58
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/VPCDeployStage-DeployVPCInfraStacks-Project/Role/DefaultPolicy/Resource
  
  AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProject2F71B601:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineVPCDeployStageDeployVPCInfraStacksProjectRoleE6260C58
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsCfnInfraVpcStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/VPCDeployStage-DeployVPCInfraStacks-Project/Resource
  
  AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProjectRole33222072:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RDSDeployStage-DeployRDSStacks-Project/Role/Resource
  
  AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProjectRoleDefaultPolicyA7BDDA34:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProject6A6EAB55
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProject6A6EAB55
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProject6A6EAB55
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProjectRoleDefaultPolicyA7BDDA34
      Roles:
        - Ref: AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProjectRole33222072
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RDSDeployStage-DeployRDSStacks-Project/Role/DefaultPolicy/Resource
  
  AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProject6A6EAB55:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineRDSDeployStageDeployRDSStacksProjectRole33222072
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsInfraRdsStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RDSDeployStage-DeployRDSStacks-Project/Resource
  
  AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProjectRole2AED6668:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RDSDeployStage-DeployECSCluster-Project/Role/Resource
  
  AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProjectRoleDefaultPolicyC4D6F26F:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProject0DAA1980
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProject0DAA1980
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProject0DAA1980
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProjectRoleDefaultPolicyC4D6F26F
      Roles:
        - Ref: AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProjectRole2AED6668
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RDSDeployStage-DeployECSCluster-Project/Role/DefaultPolicy/Resource
  
  AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProject0DAA1980:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineRDSDeployStageDeployECSClusterProjectRole2AED6668
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsInfraECSClusterStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RDSDeployStage-DeployECSCluster-Project/Resource
  AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectRoleDCDD66D5:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RegsitryDeployStage-DeployRegistryStacks-Project/Role/Resource
  AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectRoleDefaultPolicyC0B362AD:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectD788BC65
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectD788BC65
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectD788BC65
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectRoleDefaultPolicyC0B362AD
      Roles:
        - Ref: AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectRoleDCDD66D5
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RegsitryDeployStage-DeployRegistryStacks-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectD788BC65:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineRegsitryDeployStageDeployRegistryStacksProjectRoleDCDD66D5
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsInfraRegistryStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/RegsitryDeployStage-DeployRegistryStacks-Project/Resource
  AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProjectRoleE3584EDD:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/WAFCertsStage-DeployFrontEndWAF-Project/Role/Resource
  AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProjectRoleDefaultPolicy2F0EEFEA:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProject3A551A8C
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProject3A551A8C
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProject3A551A8C
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProjectRoleDefaultPolicy2F0EEFEA
      Roles:
        - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProjectRoleE3584EDD
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/WAFCertsStage-DeployFrontEndWAF-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProject3A551A8C:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineWAFCertsStageDeployFrontEndWAFProjectRoleE3584EDD
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsWafCloudFrontStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/WAFCertsStage-DeployFrontEndWAF-Project/Resource
  AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectRoleA4CD0E10:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/WAFCertsStage-DeployFrontEndCert-Project/Role/Resource
  AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectRoleDefaultPolicyF181CCA9:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectE4A1713C
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectE4A1713C
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectE4A1713C
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectRoleDefaultPolicyF181CCA9
      Roles:
        - Ref: AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectRoleA4CD0E10
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/WAFCertsStage-DeployFrontEndCert-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectE4A1713C:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineWAFCertsStageDeployFrontEndCertProjectRoleA4CD0E10
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsUsEastCertificateStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/WAFCertsStage-DeployFrontEndCert-Project/Resource
  AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectRoleA9F16177:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/MicroServiceDeployStage-DeployMicroServiceDBAccessStack-Project/Role/Resource
  AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectRoleDefaultPolicy90E6F18B:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectF2FAE9E9
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectF2FAE9E9
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectF2FAE9E9
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectRoleDefaultPolicy90E6F18B
      Roles:
        - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectRoleA9F16177
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/MicroServiceDeployStage-DeployMicroServiceDBAccessStack-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectF2FAE9E9:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceDBAccessStackProjectRoleA9F16177
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsCoreDBAccessStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/MicroServiceDeployStage-DeployMicroServiceDBAccessStack-Project/Resource
  AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProjectRole660015DF:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/MicroServiceDeployStage-DeployMicroServiceMediaStack-Project/Role/Resource
  AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProjectRoleDefaultPolicy37BCD8B5:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProject0EF57BEB
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProject0EF57BEB
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProject0EF57BEB
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProjectRoleDefaultPolicy37BCD8B5
      Roles:
        - Ref: AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProjectRole660015DF
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/MicroServiceDeployStage-DeployMicroServiceMediaStack-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProject0EF57BEB:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineMicroServiceDeployStageDeployMicroServiceMediaStackProjectRole660015DF
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsCoreMediaProcessStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/MicroServiceDeployStage-DeployMicroServiceMediaStack-Project/Resource
  AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProjectRole7DD97B9E:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/AuthStackDeployStage-DeployAuthStacks-Project/Role/Resource
  AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProjectRoleDefaultPolicy41C8B3F3:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProject4F271912
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProject4F271912
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProject4F271912
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProjectRoleDefaultPolicy41C8B3F3
      Roles:
        - Ref: AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProjectRole7DD97B9E
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/AuthStackDeployStage-DeployAuthStacks-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProject4F271912:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineAuthStackDeployStageDeployAuthStacksProjectRole7DD97B9E
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install",
                  "cdk list"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsAuthStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/AuthStackDeployStage-DeployAuthStacks-Project/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProjectRole407D89E6:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployAPIV1Stacks-Project/Role/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProjectRoleDefaultPolicy603F3994:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProject5AD64EDB
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProject5AD64EDB
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProject5AD64EDB
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProjectRoleDefaultPolicy603F3994
      Roles:
        - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProjectRole407D89E6
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployAPIV1Stacks-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProject5AD64EDB:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineAPIStackDeployStageDeployAPIV1StacksProjectRole407D89E6
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install",
                  "cdk list"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsApiV1Stack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployAPIV1Stacks-Project/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectRoleB4CFA7DC:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployAPIv2Stacks-Project/Role/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectRoleDefaultPolicy19D87D15:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectE72D7384
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectE72D7384
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectE72D7384
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectRoleDefaultPolicy19D87D15
      Roles:
        - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectRoleB4CFA7DC
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployAPIv2Stacks-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectE72D7384:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineAPIStackDeployStageDeployAPIv2StacksProjectRoleB4CFA7DC
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install",
                  "cdk list"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsApiV2Stack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployAPIv2Stacks-Project/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProjectRole8E11AFD8:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployEventStacks-Project/Role/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProjectRoleDefaultPolicy97B37394:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProject526CAEB8
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProject526CAEB8
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProject526CAEB8
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProjectRoleDefaultPolicy97B37394
      Roles:
        - Ref: AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProjectRole8E11AFD8
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployEventStacks-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProject526CAEB8:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineAPIStackDeployStageDeployEventStacksProjectRole8E11AFD8
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install",
                  "cdk list"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsEventsStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/APIStackDeployStage-DeployEventStacks-Project/Resource
  AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProjectRole6CFB9EDE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/FrontEndDeployStage-DeployFrontEndStacks-Project/Role/Resource
  AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProjectRoleDefaultPolicyA7CA150F:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProject06A26654
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProject06A26654
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProject06A26654
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProjectRoleDefaultPolicyA7CA150F
      Roles:
        - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProjectRole6CFB9EDE
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/FrontEndDeployStage-DeployFrontEndStacks-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProject06A26654:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineFrontEndDeployStageDeployFrontEndStacksProjectRole6CFB9EDE
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsFrontEndStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/FrontEndDeployStage-DeployFrontEndStacks-Project/Resource
  AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectRole40B543D5:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: codebuild.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AdministratorAccess
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/FrontEndDeployStage-DeployAPiDocStacks-Project/Role/Resource
  AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectRoleDefaultPolicyE71F79DF:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
            Effect: Allow
            Resource:
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectA6CA319E
                    - :*
              - Fn::Join:
                  - ""
                  - - arn:aws:logs:eu-central-1:551493771163:log-group:/aws/codebuild/
                    - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectA6CA319E
          - Action:
              - codebuild:BatchPutCodeCoverages
              - codebuild:BatchPutTestCases
              - codebuild:CreateReport
              - codebuild:CreateReportGroup
              - codebuild:UpdateReport
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - arn:aws:codebuild:eu-central-1:551493771163:report-group/
                  - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectA6CA319E
                  - -*
          - Action:
              - cloudformation:*
              - events:*
              - iam:PassRole
              - kms:*
              - lambda:*
              - s3:*
              - ssm:*
              - sts:AssumeRole
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetBucket*
              - s3:GetObject*
              - s3:List*
            Effect: Allow
            Resource:
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163
              - arn:aws:s3:::Aws-artifacts-eu-central-1-551493771163/*
        Version: "2012-10-17"
      PolicyName: AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectRoleDefaultPolicyE71F79DF
      Roles:
        - Ref: AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectRole40B543D5
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/FrontEndDeployStage-DeployAPiDocStacks-Project/Role/DefaultPolicy/Resource
  AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectA6CA319E:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        Type: CODEPIPELINE
      Cache:
        Type: NO_CACHE
      EncryptionKey: alias/aws/s3
      Environment:
        ComputeType: BUILD_GENERAL1_MEDIUM
        EnvironmentVariables:
          - Name: ACCOUNT
            Type: PLAINTEXT
            Value: "551493771163"
          - Name: REGION
            Type: PLAINTEXT
            Value: eu-central-1
          - Name: PROJECT_NAME
            Type: PLAINTEXT
            Value: Aws
          - Name: PROJECT_STAGE
            Type: PLAINTEXT
            Value: dev
          - Name: PROJECT_PREFIX
            Type: PLAINTEXT
            Value: Aws
          - Name: APP_CONFIG
            Type: PLAINTEXT
            Value: config/app-config-infra-pipeline-dev.json
          - Name: ASSUME_ROLE_ARN
            Type: PLAINTEXT
            Value: ""
          - Name: ON_PIPELINE
            Type: PLAINTEXT
            Value: "YES"
          - Name: BUILDNUMBER
            Type: PLAINTEXT
            Value: devbuild
        Image: aws/codebuild/standard:5.0
        ImagePullCredentialsType: CODEBUILD
        PrivilegedMode: true
        Type: LINUX_CONTAINER
      ServiceRole:
        Fn::GetAtt:
          - AwsInfrastructurePipelineFrontEndDeployStageDeployAPiDocStacksProjectRole40B543D5
          - Arn
      Source:
        BuildSpec: |-
          {
            "version": "0.2",
            "phases": {
              "install": {
                "runtime-versions": {
                  "nodejs": 14
                },
                "commands": [
                  "npm install -g aws-cdk@2"
                ]
              },
              "pre_build": {
                "commands": [
                  "ls -al",
                  "aws sts get-caller-identity",
                  "cd templates/iac/Aws-api-prod-ts",
                  "npm install",
                  "cdk list"
                ]
              },
              "build": {
                "commands": [
                  "cdk deploy Aws-AwsApiDocsStack --require-approval never"
                ]
              },
              "post_build": {}
            },
            "artifacts": {
              "files": [
                "**/*"
              ],
              "exclude-paths": [
                "cdk.out/",
                "node_modules/",
                ".git/"
              ]
            }
          }
        Type: CODEPIPELINE
      Tags:
        - Key: budget-unit-code
          Value: madrid-Aws
      TimeoutInMinutes: 60
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/AwsInfrastructurePipeline/FrontEndDeployStage-DeployAPiDocStacks-Project/Resource
  
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/1WOzU7DMBCEn6V3Z2kKgjPtqeJAFB6gcu2ttIl/Iv+Aqsjvju0YEKf9ZnY0mgP0Ty/Q7/iX74ScO0VXWD8CFzMTykZ5s07zQNZcyAgVJcLpZs4bsowDd1xjQFfEyRpJJcxy3WWdtYc12294L99XRdwn5h+reYxixsB+abCKxJ1t4sg9JkZc12h7ZRqtQtZk4dzmNfybIazEhRZUZBDWoVGd2jjVzDWSkn+BwdkJRd3TMKUi3mNYYmAjehudqD0/nJjJPTD5h8/+GQ572O8mT9S5aAJphHG735SvlOxiAQAA
    Metadata:
      aws:cdk:path: Aws-AwsInfrastructrePipelineStack/CDKMetadata/Default
Outputs:
  ArtifactsBucket:
    Description: The name of the artifact bucket
    Value:
      Ref: ArtifactsBucket
  ArtifactsBucketArn:
    Description: The Arn of the artifact bucket
    Value:
      Fn::GetAtt: ArtifactsBucket.Arn
  KMSKeyArn:
    Description: The Arn of the KMS key
    Value:
      Fn::GetAtt: KMSKey.Arn
  AwsArtifactBucketDomain:
    Value:
      Fn::Sub: ${ArtifactsBucket}.s3.amazonaws.com
Rules:
  CheckBootstrapVersion:
    Assertions:
      - Assert:
          Fn::Not:
            - Fn::Contains:
                - - "1"
                  - "2"
                  - "3"
                  - "4"
                  - "5"
                - Ref: BootstrapVersion
        AssertDescription: CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.

